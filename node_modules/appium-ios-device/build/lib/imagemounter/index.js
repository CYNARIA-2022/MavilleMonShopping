"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MOBILE_IMAGE_MOUNTER_SERVICE_NAME = exports.ImageMounter = void 0;
require("source-map-support/register");
var _baseService = require("../base-service");
var _support = require("@appium/support");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _logger = _interopRequireDefault(require("../logger"));
const {
  lstat,
  readFile,
  createReadStream
} = _support.fs;
const MOBILE_IMAGE_MOUNTER_SERVICE_NAME = 'com.apple.mobile.mobile_image_mounter';
exports.MOBILE_IMAGE_MOUNTER_SERVICE_NAME = MOBILE_IMAGE_MOUNTER_SERVICE_NAME;
const FILE_TYPE_IMAGE = 'image';
const FILE_TYPE_SIGNATURE = 'signature';
function checkIfError(ret) {
  if (ret.Error) {
    throw new Error(ret.Error);
  }
  return ret;
}
async function assertIsFile(filePath, fileType) {
  let fileStat;
  try {
    fileStat = await lstat(filePath);
  } catch (err) {
    if (err.code === 'ENOENT') {
      throw new Error(`The provided ${fileType} path does not exist: ${filePath}`);
    }
    throw err;
  }
  if (fileStat.isDirectory()) {
    throw new Error(`The provided ${fileType} path is expected to be a file, but a directory was given: ${filePath}`);
  }
  return fileStat;
}
class ImageMounter extends _baseService.BaseServicePlist {
  async lookup(imageType = 'Developer') {
    const ret = await this._plistService.sendPlistAndReceive({
      Command: 'LookupImage',
      ImageType: imageType
    });
    return checkIfError(ret).ImageSignature || [];
  }
  async isDeveloperImageMounted() {
    return (await this.lookup()).length > 0;
  }
  async mount(imageFilePath, imageSignatureFilePath, imageType = 'Developer') {
    var _mountResult$Detailed;
    const [imageFileStat] = await _bluebird.default.all([assertIsFile(imageFilePath, FILE_TYPE_IMAGE), assertIsFile(imageSignatureFilePath, FILE_TYPE_SIGNATURE)]);
    const signature = await readFile(imageSignatureFilePath);
    const mountedImages = await this.lookup(imageType);
    if (mountedImages.find(mountedSignature => signature.equals(mountedSignature))) {
      _logger.default.info(`An image with same signature of ${imageSignatureFilePath} is mounted. Doing nothing here`);
      return;
    }
    const imageSize = imageFileStat.size;
    const receiveBytesResult = await this._plistService.sendPlistAndReceive({
      Command: 'ReceiveBytes',
      ImageSignature: signature,
      ImageSize: imageSize,
      ImageType: imageType
    });
    if (checkIfError(receiveBytesResult).Status !== 'ReceiveBytesAck') {
      const errMsg = `Unexpected return from ${MOBILE_IMAGE_MOUNTER_SERVICE_NAME} on sending ReceiveBytes`;
      throw new Error(`${errMsg}: ${JSON.stringify(receiveBytesResult)}`);
    }
    const stream = createReadStream(imageFilePath);
    try {
      await new _bluebird.default((resolve, reject) => {
        stream.on('end', resolve);
        stream.on('error', reject);
        stream.on('data', async data => {
          try {
            await this._plistService._socketClient.write(data);
          } catch (e) {
            stream.emit('error', e);
          }
        });
      });
    } finally {
      stream.close();
    }
    const pushImageResult = await this._plistService.receivePlist();
    if (checkIfError(pushImageResult).Status !== 'Complete') {
      const errMsg = `Unexpected return from ${MOBILE_IMAGE_MOUNTER_SERVICE_NAME} on pushing image file`;
      throw new Error(`${errMsg}: ${JSON.stringify(pushImageResult)}`);
    }
    const mountResult = await this._plistService.sendPlistAndReceive({
      Command: 'MountImage',
      ImagePath: '/private/var/mobile/Media/PublicStaging/staging.dimag',
      ImageSignature: signature,
      ImageType: imageType
    });
    if ((_mountResult$Detailed = mountResult.DetailedError) !== null && _mountResult$Detailed !== void 0 && _mountResult$Detailed.includes('is already mounted at /Developer')) {
      _logger.default.info('DeveloperImage was already mounted');
      return;
    }
    checkIfError(mountResult);
  }
}
exports.ImageMounter = ImageMounter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYmFzZVNlcnZpY2UiLCJyZXF1aXJlIiwiX3N1cHBvcnQiLCJfYmx1ZWJpcmQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2xvZ2dlciIsImxzdGF0IiwicmVhZEZpbGUiLCJjcmVhdGVSZWFkU3RyZWFtIiwiZnMiLCJNT0JJTEVfSU1BR0VfTU9VTlRFUl9TRVJWSUNFX05BTUUiLCJleHBvcnRzIiwiRklMRV9UWVBFX0lNQUdFIiwiRklMRV9UWVBFX1NJR05BVFVSRSIsImNoZWNrSWZFcnJvciIsInJldCIsIkVycm9yIiwiYXNzZXJ0SXNGaWxlIiwiZmlsZVBhdGgiLCJmaWxlVHlwZSIsImZpbGVTdGF0IiwiZXJyIiwiY29kZSIsImlzRGlyZWN0b3J5IiwiSW1hZ2VNb3VudGVyIiwiQmFzZVNlcnZpY2VQbGlzdCIsImxvb2t1cCIsImltYWdlVHlwZSIsIl9wbGlzdFNlcnZpY2UiLCJzZW5kUGxpc3RBbmRSZWNlaXZlIiwiQ29tbWFuZCIsIkltYWdlVHlwZSIsIkltYWdlU2lnbmF0dXJlIiwiaXNEZXZlbG9wZXJJbWFnZU1vdW50ZWQiLCJsZW5ndGgiLCJtb3VudCIsImltYWdlRmlsZVBhdGgiLCJpbWFnZVNpZ25hdHVyZUZpbGVQYXRoIiwiX21vdW50UmVzdWx0JERldGFpbGVkIiwiaW1hZ2VGaWxlU3RhdCIsIkIiLCJhbGwiLCJzaWduYXR1cmUiLCJtb3VudGVkSW1hZ2VzIiwiZmluZCIsIm1vdW50ZWRTaWduYXR1cmUiLCJlcXVhbHMiLCJsb2ciLCJpbmZvIiwiaW1hZ2VTaXplIiwic2l6ZSIsInJlY2VpdmVCeXRlc1Jlc3VsdCIsIkltYWdlU2l6ZSIsIlN0YXR1cyIsImVyck1zZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdHJlYW0iLCJyZXNvbHZlIiwicmVqZWN0Iiwib24iLCJkYXRhIiwiX3NvY2tldENsaWVudCIsIndyaXRlIiwiZSIsImVtaXQiLCJjbG9zZSIsInB1c2hJbWFnZVJlc3VsdCIsInJlY2VpdmVQbGlzdCIsIm1vdW50UmVzdWx0IiwiSW1hZ2VQYXRoIiwiRGV0YWlsZWRFcnJvciIsImluY2x1ZGVzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2ltYWdlbW91bnRlci9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlU2VydmljZVBsaXN0IH0gZnJvbSAnLi4vYmFzZS1zZXJ2aWNlJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmNvbnN0IHsgbHN0YXQsIHJlYWRGaWxlLCBjcmVhdGVSZWFkU3RyZWFtIH0gPSBmcztcblxuY29uc3QgTU9CSUxFX0lNQUdFX01PVU5URVJfU0VSVklDRV9OQU1FID0gJ2NvbS5hcHBsZS5tb2JpbGUubW9iaWxlX2ltYWdlX21vdW50ZXInO1xuY29uc3QgRklMRV9UWVBFX0lNQUdFID0gJ2ltYWdlJztcbmNvbnN0IEZJTEVfVFlQRV9TSUdOQVRVUkUgPSAnc2lnbmF0dXJlJztcblxuZnVuY3Rpb24gY2hlY2tJZkVycm9yKHJldCkge1xuICAgIGlmIChyZXQuRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJldC5FcnJvcik7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFzc2VydElzRmlsZShmaWxlUGF0aCwgZmlsZVR5cGUpIHtcbiAgICAvKiogQHR5cGUge2ltcG9ydCgnZnMnKS5TdGF0cyB8IHVuZGVmaW5lZH0gKi9cbiAgICBsZXQgZmlsZVN0YXQ7XG4gICAgdHJ5IHtcbiAgICAgICAgZmlsZVN0YXQgPSBhd2FpdCBsc3RhdChmaWxlUGF0aCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmICgvKiogQHR5cGUge05vZGVKUy5FcnJub0V4Y2VwdGlvbn0gKi8oZXJyKS5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcHJvdmlkZWQgJHtmaWxlVHlwZX0gcGF0aCBkb2VzIG5vdCBleGlzdDogJHtmaWxlUGF0aH1gKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGlmIChmaWxlU3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHByb3ZpZGVkICR7ZmlsZVR5cGV9IHBhdGggaXMgZXhwZWN0ZWQgdG8gYmUgYSBmaWxlLCBidXQgYSBkaXJlY3Rvcnkgd2FzIGdpdmVuOiAke2ZpbGVQYXRofWApO1xuICAgIH1cbiAgICByZXR1cm4gZmlsZVN0YXQ7XG59XG5cbmNsYXNzIEltYWdlTW91bnRlciBleHRlbmRzIEJhc2VTZXJ2aWNlUGxpc3Qge1xuXG4gICAgLyoqXG4gICAgICogTG9va3VwIGZvciBtb3VudGVkIGltYWdlcy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaW1hZ2VUeXBlIFR5cGUgb2YgaW1hZ2UsIGBEZXZlbG9wZXJgIGJ5IGRlZmF1bHQuXG4gICAgICogQHJldHVybnMge1Byb21pc2U8QnVmZmVyW10+fSBTaWduYXR1cmUgb2YgZWFjaCBtb3VudGVkIGltYWdlLlxuICAgICAqL1xuICAgIGFzeW5jIGxvb2t1cChpbWFnZVR5cGUgPSAnRGV2ZWxvcGVyJykge1xuICAgICAgICBjb25zdCByZXQgPSBhd2FpdCB0aGlzLl9wbGlzdFNlcnZpY2Uuc2VuZFBsaXN0QW5kUmVjZWl2ZSh7XG4gICAgICAgICAgICBDb21tYW5kOiAnTG9va3VwSW1hZ2UnLFxuICAgICAgICAgICAgSW1hZ2VUeXBlOiBpbWFnZVR5cGVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjaGVja0lmRXJyb3IocmV0KS5JbWFnZVNpZ25hdHVyZSB8fCBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBkZXZlbG9wZXIgaW1hZ2UgaXMgbW91bnRlZC5cbiAgICAgKi9cbiAgICBhc3luYyBpc0RldmVsb3BlckltYWdlTW91bnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIChhd2FpdCB0aGlzLmxvb2t1cCgpKS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1vdW50IGltYWdlIGZvciBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGltYWdlRmlsZVBhdGggVGhlIGZpbGUgcGF0aCBvZiBpbWFnZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaW1hZ2VTaWduYXR1cmVGaWxlUGF0aCBUaGUgc2lnbmF0dXJlIGZpbGUgcGF0aCBvZiBnaXZlbiBgRGV2ZWxvcGVyRGlza0ltYWdlLmRtZ2BcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaW1hZ2VUeXBlIFR5cGUgb2YgaW1hZ2UsIGBEZXZlbG9wZXJgIGJ5IGRlZmF1bHQuXG4gICAgICovXG4gICAgYXN5bmMgbW91bnQoaW1hZ2VGaWxlUGF0aCwgaW1hZ2VTaWduYXR1cmVGaWxlUGF0aCwgaW1hZ2VUeXBlID0gJ0RldmVsb3BlcicpIHtcbiAgICAgICAgLy9jaGVjayBmaWxlIHN0YXRzXG4gICAgICAgIGNvbnN0IFtpbWFnZUZpbGVTdGF0XSA9IGF3YWl0IEIuYWxsKFtcbiAgICAgICAgICAgIGFzc2VydElzRmlsZShpbWFnZUZpbGVQYXRoLCBGSUxFX1RZUEVfSU1BR0UpLFxuICAgICAgICAgICAgYXNzZXJ0SXNGaWxlKGltYWdlU2lnbmF0dXJlRmlsZVBhdGgsIEZJTEVfVFlQRV9TSUdOQVRVUkUpXG4gICAgICAgIF0pO1xuICAgICAgICAvL3JlYWQgc2lnbmF0dXJlXG4gICAgICAgIGNvbnN0IHNpZ25hdHVyZSA9IGF3YWl0IHJlYWRGaWxlKGltYWdlU2lnbmF0dXJlRmlsZVBhdGgpO1xuICAgICAgICBjb25zdCBtb3VudGVkSW1hZ2VzID0gYXdhaXQgdGhpcy5sb29rdXAoaW1hZ2VUeXBlKTtcbiAgICAgICAgaWYgKG1vdW50ZWRJbWFnZXMuZmluZCgobW91bnRlZFNpZ25hdHVyZSkgPT4gc2lnbmF0dXJlLmVxdWFscyhtb3VudGVkU2lnbmF0dXJlKSkpIHtcbiAgICAgICAgICAgIGxvZy5pbmZvKGBBbiBpbWFnZSB3aXRoIHNhbWUgc2lnbmF0dXJlIG9mICR7aW1hZ2VTaWduYXR1cmVGaWxlUGF0aH0gaXMgbW91bnRlZC4gRG9pbmcgbm90aGluZyBoZXJlYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy9ub3RpZnkgZGV2aWNlXG4gICAgICAgIGNvbnN0IGltYWdlU2l6ZSA9IGltYWdlRmlsZVN0YXQuc2l6ZTtcbiAgICAgICAgY29uc3QgcmVjZWl2ZUJ5dGVzUmVzdWx0ID0gYXdhaXQgdGhpcy5fcGxpc3RTZXJ2aWNlLnNlbmRQbGlzdEFuZFJlY2VpdmUoe1xuICAgICAgICAgICAgQ29tbWFuZDogJ1JlY2VpdmVCeXRlcycsXG4gICAgICAgICAgICBJbWFnZVNpZ25hdHVyZTogc2lnbmF0dXJlLFxuICAgICAgICAgICAgSW1hZ2VTaXplOiBpbWFnZVNpemUsXG4gICAgICAgICAgICBJbWFnZVR5cGU6IGltYWdlVHlwZVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGNoZWNrSWZFcnJvcihyZWNlaXZlQnl0ZXNSZXN1bHQpLlN0YXR1cyAhPT0gJ1JlY2VpdmVCeXRlc0FjaycpIHtcbiAgICAgICAgICAgIGNvbnN0IGVyck1zZyA9IGBVbmV4cGVjdGVkIHJldHVybiBmcm9tICR7TU9CSUxFX0lNQUdFX01PVU5URVJfU0VSVklDRV9OQU1FfSBvbiBzZW5kaW5nIFJlY2VpdmVCeXRlc2A7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7ZXJyTXNnfTogJHtKU09OLnN0cmluZ2lmeShyZWNlaXZlQnl0ZXNSZXN1bHQpfWApO1xuICAgICAgICB9XG4gICAgICAgIC8vcHVzaCBpbWFnZSB0byBkZXZpY2VcbiAgICAgICAgY29uc3Qgc3RyZWFtID0gY3JlYXRlUmVhZFN0cmVhbShpbWFnZUZpbGVQYXRoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBzdHJlYW0ub24oJ2VuZCcsIHJlc29sdmUpO1xuICAgICAgICAgICAgICAgIHN0cmVhbS5vbignZXJyb3InLCByZWplY3QpO1xuICAgICAgICAgICAgICAgIHN0cmVhbS5vbignZGF0YScsIGFzeW5jIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9wbGlzdFNlcnZpY2UuX3NvY2tldENsaWVudC53cml0ZShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmVtaXQoJ2Vycm9yJywgZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgc3RyZWFtLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHVzaEltYWdlUmVzdWx0ID0gYXdhaXQgdGhpcy5fcGxpc3RTZXJ2aWNlLnJlY2VpdmVQbGlzdCgpO1xuICAgICAgICBpZiAoY2hlY2tJZkVycm9yKHB1c2hJbWFnZVJlc3VsdCkuU3RhdHVzICE9PSAnQ29tcGxldGUnKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJNc2cgPSBgVW5leHBlY3RlZCByZXR1cm4gZnJvbSAke01PQklMRV9JTUFHRV9NT1VOVEVSX1NFUlZJQ0VfTkFNRX0gb24gcHVzaGluZyBpbWFnZSBmaWxlYDtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtlcnJNc2d9OiAke0pTT04uc3RyaW5naWZ5KHB1c2hJbWFnZVJlc3VsdCl9YCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9tb3VudCBpbWFnZVxuICAgICAgICBjb25zdCBtb3VudFJlc3VsdCA9IGF3YWl0IHRoaXMuX3BsaXN0U2VydmljZS5zZW5kUGxpc3RBbmRSZWNlaXZlKHtcbiAgICAgICAgICAgIENvbW1hbmQ6ICdNb3VudEltYWdlJyxcbiAgICAgICAgICAgIEltYWdlUGF0aDogJy9wcml2YXRlL3Zhci9tb2JpbGUvTWVkaWEvUHVibGljU3RhZ2luZy9zdGFnaW5nLmRpbWFnJyxcbiAgICAgICAgICAgIEltYWdlU2lnbmF0dXJlOiBzaWduYXR1cmUsXG4gICAgICAgICAgICBJbWFnZVR5cGU6IGltYWdlVHlwZVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG1vdW50UmVzdWx0LkRldGFpbGVkRXJyb3I/LmluY2x1ZGVzKCdpcyBhbHJlYWR5IG1vdW50ZWQgYXQgL0RldmVsb3BlcicpKSB7XG4gICAgICAgICAgICBsb2cuaW5mbygnRGV2ZWxvcGVySW1hZ2Ugd2FzIGFscmVhZHkgbW91bnRlZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNoZWNrSWZFcnJvcihtb3VudFJlc3VsdCk7XG4gICAgfVxufVxuZXhwb3J0IHsgSW1hZ2VNb3VudGVyLCBNT0JJTEVfSU1BR0VfTU9VTlRFUl9TRVJWSUNFX05BTUUgfTsiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsWUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsUUFBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsU0FBQSxHQUFBQyxzQkFBQSxDQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBRCxzQkFBQSxDQUFBSCxPQUFBO0FBQ0EsTUFBTTtFQUFFSyxLQUFLO0VBQUVDLFFBQVE7RUFBRUM7QUFBaUIsQ0FBQyxHQUFHQyxXQUFFO0FBRWhELE1BQU1DLGlDQUFpQyxHQUFHLHVDQUF1QztBQUFDQyxPQUFBLENBQUFELGlDQUFBLEdBQUFBLGlDQUFBO0FBQ2xGLE1BQU1FLGVBQWUsR0FBRyxPQUFPO0FBQy9CLE1BQU1DLG1CQUFtQixHQUFHLFdBQVc7QUFFdkMsU0FBU0MsWUFBWUEsQ0FBQ0MsR0FBRyxFQUFFO0VBQ3ZCLElBQUlBLEdBQUcsQ0FBQ0MsS0FBSyxFQUFFO0lBQ1gsTUFBTSxJQUFJQSxLQUFL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